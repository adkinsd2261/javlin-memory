
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jav Studio - Creative Co-Builder</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <script src="https://unpkg.com/monaco-editor@0.45.0/min/vs/loader.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --jav-primary: #6366F1;
            --jav-secondary: #8B5CF6;
            --jav-accent: #06B6D4;
            --jav-success: #10B981;
            --jav-warning: #F59E0B;
            --jav-error: #EF4444;
            --jav-bg: #0F172A;
            --jav-surface: #1E293B;
            --jav-card: #334155;
            --jav-border: #475569;
            --jav-text: #F1F5F9;
            --jav-text-muted: #94A3B8;
            --jav-gradient: linear-gradient(135deg, var(--jav-primary), var(--jav-secondary));
        }
        
        body {
            background: var(--jav-bg);
            color: var(--jav-text);
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            overflow: hidden;
        }
        
        .studio-container {
            display: grid;
            grid-template-columns: 1fr 420px;
            height: 100vh;
            gap: 1px;
            background: var(--jav-border);
        }
        
        .code-canvas {
            background: var(--jav-bg);
            position: relative;
            overflow: hidden;
        }
        
        .creative-panel {
            background: var(--jav-surface);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            border-left: 1px solid var(--jav-border);
        }
        
        .panel-header {
            padding: 20px;
            background: var(--jav-gradient);
            color: white;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .jav-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 12px;
            animation: pulse 2s infinite;
        }
        
        .creative-space {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        .conversation-flow {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            background: rgba(0, 0, 0, 0.1);
        }
        
        .insight-card {
            margin-bottom: 16px;
            padding: 16px;
            border-radius: 16px;
            border: 1px solid var(--jav-border);
            position: relative;
            cursor: move;
            transition: all 0.3s ease;
            background: var(--jav-card);
        }
        
        .insight-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
            border-color: var(--jav-primary);
        }
        
        .insight-card.dragging {
            opacity: 0.8;
            transform: rotate(2deg);
            z-index: 1000;
        }
        
        .insight-card.suggestion {
            border-left: 4px solid var(--jav-accent);
            background: linear-gradient(135deg, var(--jav-card), rgba(6, 182, 212, 0.05));
        }
        
        .insight-card.error {
            border-left: 4px solid var(--jav-error);
            background: linear-gradient(135deg, var(--jav-card), rgba(239, 68, 68, 0.05));
        }
        
        .insight-card.idea {
            border-left: 4px solid var(--jav-secondary);
            background: linear-gradient(135deg, var(--jav-card), rgba(139, 92, 246, 0.05));
        }
        
        .insight-card.pinned {
            border: 2px solid var(--jav-warning);
            background: linear-gradient(135deg, var(--jav-card), rgba(245, 158, 11, 0.1));
        }
        
        .insight-card.pinned::before {
            content: '📌';
            position: absolute;
            top: 8px;
            right: 8px;
            font-size: 12px;
        }
        
        .card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 12px;
        }
        
        .card-source {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 12px;
            font-weight: 600;
            color: var(--jav-text-muted);
        }
        
        .card-actions {
            display: flex;
            gap: 8px;
            opacity: 0;
            transition: opacity 0.2s;
        }
        
        .insight-card:hover .card-actions {
            opacity: 1;
        }
        
        .action-button {
            width: 24px;
            height: 24px;
            border-radius: 6px;
            border: none;
            background: rgba(255, 255, 255, 0.1);
            color: var(--jav-text-muted);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            transition: all 0.2s;
        }
        
        .action-button:hover {
            background: var(--jav-primary);
            color: white;
            transform: scale(1.1);
        }
        
        .card-content {
            line-height: 1.6;
            margin-bottom: 12px;
        }
        
        .quick-actions {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }
        
        .quick-action {
            padding: 6px 12px;
            border-radius: 20px;
            border: 1px solid var(--jav-border);
            background: rgba(255, 255, 255, 0.05);
            color: var(--jav-text);
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .quick-action:hover {
            background: var(--jav-primary);
            border-color: var(--jav-primary);
            transform: translateY(-1px);
        }
        
        .quick-action.primary {
            background: var(--jav-primary);
            border-color: var(--jav-primary);
            color: white;
        }
        
        .chat-area {
            padding: 20px;
            border-top: 1px solid var(--jav-border);
            background: rgba(0, 0, 0, 0.2);
        }
        
        .chat-input-container {
            position: relative;
        }
        
        .chat-input {
            width: 100%;
            min-height: 60px;
            max-height: 120px;
            padding: 16px 50px 16px 16px;
            border: 2px solid var(--jav-border);
            border-radius: 16px;
            background: var(--jav-card);
            color: var(--jav-text);
            resize: none;
            font-size: 14px;
            line-height: 1.5;
            transition: all 0.3s ease;
        }
        
        .chat-input:focus {
            outline: none;
            border-color: var(--jav-primary);
            box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.1);
        }
        
        .chat-input::placeholder {
            color: var(--jav-text-muted);
        }
        
        .send-button {
            position: absolute;
            right: 8px;
            bottom: 8px;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border: none;
            background: var(--jav-gradient);
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }
        
        .send-button:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 15px rgba(99, 102, 241, 0.4);
        }
        
        .send-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        .conversation-bubble {
            margin-bottom: 16px;
            display: flex;
            gap: 12px;
            animation: slideIn 0.4s ease;
        }
        
        .bubble-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            flex-shrink: 0;
        }
        
        .jav-bubble-avatar {
            background: var(--jav-gradient);
            color: white;
        }
        
        .user-bubble-avatar {
            background: var(--jav-accent);
            color: white;
        }
        
        .bubble-content {
            flex: 1;
            padding: 12px 16px;
            border-radius: 16px;
            max-width: 280px;
            position: relative;
        }
        
        .jav-bubble {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.15), rgba(139, 92, 246, 0.1));
            border: 1px solid rgba(99, 102, 241, 0.2);
        }
        
        .user-bubble {
            background: linear-gradient(135deg, rgba(6, 182, 212, 0.15), rgba(6, 182, 212, 0.1));
            border: 1px solid rgba(6, 182, 212, 0.2);
        }
        
        .typing-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px 16px;
            background: rgba(99, 102, 241, 0.1);
            border-radius: 16px;
            margin-left: 44px;
        }
        
        .typing-dots {
            display: flex;
            gap: 4px;
        }
        
        .typing-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: var(--jav-primary);
            animation: typingDot 1.4s infinite;
        }
        
        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }
        
        .drop-zone {
            min-height: 60px;
            border: 2px dashed var(--jav-border);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--jav-text-muted);
            margin: 12px 0;
            transition: all 0.3s ease;
        }
        
        .drop-zone.active {
            border-color: var(--jav-primary);
            background: rgba(99, 102, 241, 0.05);
            color: var(--jav-primary);
        }
        
        .floating-toolbar {
            position: fixed;
            bottom: 20px;
            left: 20px;
            display: flex;
            gap: 8px;
            z-index: 100;
        }
        
        .toolbar-button {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            border: none;
            background: var(--jav-surface);
            color: var(--jav-text);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            border: 1px solid var(--jav-border);
        }
        
        .toolbar-button:hover {
            background: var(--jav-primary);
            border-color: var(--jav-primary);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(99, 102, 241, 0.3);
        }
        
        .health-indicator {
            position: absolute;
            top: 20px;
            right: 20px;
            padding: 8px 16px;
            border-radius: 20px;
            background: var(--jav-surface);
            border: 1px solid var(--jav-border);
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 12px;
            backdrop-filter: blur(10px);
        }
        
        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--jav-success);
            animation: pulse 2s infinite;
        }
        
        .code-overlay {
            position: absolute;
            top: 100px;
            left: 20px;
            max-width: 300px;
            padding: 12px 16px;
            background: var(--jav-surface);
            border: 1px solid var(--jav-border);
            border-radius: 12px;
            backdrop-filter: blur(20px);
            z-index: 50;
            animation: popIn 0.3s ease;
        }
        
        @keyframes slideIn {
            from { transform: translateX(-20px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        @keyframes popIn {
            from { transform: scale(0.9) translateY(10px); opacity: 0; }
            to { transform: scale(1) translateY(0); opacity: 1; }
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(1.05); }
        }
        
        @keyframes typingDot {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-8px); }
        }
        
        .drag-helper {
            position: fixed;
            pointer-events: none;
            z-index: 1000;
            opacity: 0.8;
            transform: rotate(5deg);
        }
        
        .reaction-menu {
            position: absolute;
            top: -10px;
            right: -10px;
            display: flex;
            gap: 4px;
            background: var(--jav-surface);
            border: 1px solid var(--jav-border);
            border-radius: 20px;
            padding: 4px;
            opacity: 0;
            transform: scale(0.8);
            transition: all 0.2s;
        }
        
        .insight-card:hover .reaction-menu {
            opacity: 1;
            transform: scale(1);
        }
        
        .reaction-button {
            width: 24px;
            height: 24px;
            border: none;
            background: transparent;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            transition: all 0.2s;
        }
        
        .reaction-button:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: scale(1.2);
        }
    </style>
</head>
<body>
    <div x-data="javStudio()" x-init="init()" class="studio-container">
        
        <!-- Code Canvas -->
        <div class="code-canvas">
            <div id="monaco-editor" class="w-full h-full"></div>
            
            <!-- Health Indicator -->
            <div class="health-indicator">
                <div class="status-dot" :class="{ 'bg-red-500': hasErrors, 'bg-yellow-500': hasWarnings }"></div>
                <span x-text="systemHealth"></span>
            </div>
            
            <!-- Code Overlay Insights -->
            <div x-show="codeInsight" x-transition class="code-overlay">
                <div class="text-sm font-medium mb-2" x-text="codeInsight?.title"></div>
                <div class="text-xs text-gray-400 mb-3" x-text="codeInsight?.message"></div>
                <div class="flex gap-2">
                    <button @click="applyCodeSuggestion()" 
                            class="quick-action primary text-xs">Apply</button>
                    <button @click="codeInsight = null" 
                            class="quick-action text-xs">Dismiss</button>
                </div>
            </div>
        </div>
        
        <!-- Creative Studio Panel -->
        <div class="creative-panel">
            
            <!-- Panel Header -->
            <div class="panel-header">
                <div class="flex items-center">
                    <div class="jav-avatar">
                        <i class="fas fa-palette"></i>
                    </div>
                    <div>
                        <div class="font-semibold">Creative Studio</div>
                        <div class="text-xs opacity-90" x-text="studioStatus"></div>
                    </div>
                </div>
                <div class="flex items-center gap-3">
                    <button @click="clearStudio()" class="text-xs opacity-75 hover:opacity-100">
                        Clear
                    </button>
                    <i class="fas fa-magic"></i>
                </div>
            </div>
            
            <!-- Creative Space -->
            <div class="creative-space">
                
                <!-- Conversation Flow -->
                <div class="conversation-flow" x-ref="conversationContainer">
                    
                    <!-- Insight Cards -->
                    <template x-for="item in studioItems" :key="item.id">
                        <div class="insight-card" 
                             :class="[item.type, { 'pinned': item.pinned }]"
                             draggable="true"
                             @dragstart="startDrag($event, item)"
                             @dragend="endDrag()">
                            
                            <!-- Reaction Menu -->
                            <div class="reaction-menu">
                                <button class="reaction-button" @click="reactToItem(item, '👍')">👍</button>
                                <button class="reaction-button" @click="reactToItem(item, '💡')">💡</button>
                                <button class="reaction-button" @click="reactToItem(item, '❤️')">❤️</button>
                            </div>
                            
                            <!-- Card Header -->
                            <div class="card-header">
                                <div class="card-source">
                                    <i :class="getSourceIcon(item.source)"></i>
                                    <span x-text="item.source"></span>
                                    <span class="text-xs opacity-60" x-text="timeAgo(item.timestamp)"></span>
                                </div>
                                <div class="card-actions">
                                    <button class="action-button" 
                                            @click="togglePin(item)"
                                            :title="item.pinned ? 'Unpin' : 'Pin'">
                                        <i :class="item.pinned ? 'fas fa-thumbtack' : 'far fa-thumbtack'"></i>
                                    </button>
                                    <button class="action-button" 
                                            @click="expandItem(item)"
                                            title="Expand">
                                        <i class="fas fa-expand"></i>
                                    </button>
                                    <button class="action-button" 
                                            @click="removeItem(item.id)"
                                            title="Remove">
                                        <i class="fas fa-times"></i>
                                    </button>
                                </div>
                            </div>
                            
                            <!-- Card Content -->
                            <div class="card-content" x-text="item.content"></div>
                            
                            <!-- Quick Actions -->
                            <div x-show="item.actions && item.actions.length > 0" class="quick-actions">
                                <template x-for="action in item.actions" :key="action.id">
                                    <button class="quick-action" 
                                            :class="{ 'primary': action.primary }"
                                            @click="executeAction(action, item)"
                                            x-text="action.label"></button>
                                </template>
                            </div>
                            
                            <!-- Reactions Display -->
                            <div x-show="item.reactions && Object.keys(item.reactions).length > 0" 
                                 class="flex gap-1 mt-2">
                                <template x-for="[emoji, count] in Object.entries(item.reactions || {})" :key="emoji">
                                    <span class="text-xs bg-gray-700 px-2 py-1 rounded-full" 
                                          x-text="`${emoji} ${count}`"></span>
                                </template>
                            </div>
                        </div>
                    </template>
                    
                    <!-- Conversation Bubbles -->
                    <template x-for="message in conversationHistory" :key="message.id">
                        <div class="conversation-bubble">
                            <div class="bubble-avatar" 
                                 :class="message.isJav ? 'jav-bubble-avatar' : 'user-bubble-avatar'">
                                <i :class="message.isJav ? 'fas fa-robot' : 'fas fa-user'"></i>
                            </div>
                            <div class="bubble-content" 
                                 :class="message.isJav ? 'jav-bubble' : 'user-bubble'">
                                <div x-text="message.content"></div>
                                <div x-show="message.timestamp" 
                                     class="text-xs opacity-60 mt-1" 
                                     x-text="timeAgo(message.timestamp)"></div>
                            </div>
                        </div>
                    </template>
                    
                    <!-- Typing Indicator -->
                    <div x-show="javTyping" class="typing-indicator">
                        <span class="text-sm">Jav is thinking</span>
                        <div class="typing-dots">
                            <div class="typing-dot"></div>
                            <div class="typing-dot"></div>
                            <div class="typing-dot"></div>
                        </div>
                    </div>
                    
                    <!-- Drop Zone -->
                    <div class="drop-zone" 
                         :class="{ 'active': dragActive }"
                         @dragover.prevent="dragActive = true"
                         @dragleave="dragActive = false"
                         @drop.prevent="handleDrop($event)">
                        <div x-show="!dragActive">
                            <i class="fas fa-hand-paper mr-2"></i>
                            Drag cards here to combine or organize
                        </div>
                        <div x-show="dragActive">
                            <i class="fas fa-magic mr-2"></i>
                            Drop to organize or combine ideas
                        </div>
                    </div>
                    
                    <!-- Empty State -->
                    <div x-show="studioItems.length === 0 && conversationHistory.length === 0" 
                         class="text-center py-12 text-gray-400">
                        <i class="fas fa-palette text-4xl mb-4 opacity-50"></i>
                        <div class="text-lg font-medium mb-2">Welcome to Jav Studio</div>
                        <div class="text-sm">Start coding or ask me anything to begin our creative session</div>
                    </div>
                </div>
                
                <!-- Chat Area -->
                <div class="chat-area">
                    <div class="chat-input-container">
                        <textarea x-model="chatMessage" 
                                  @keydown.enter.prevent="handleEnter($event)"
                                  @input="handleInputChange()"
                                  placeholder="What's on your mind? Let's brainstorm, debug, or just chat..."
                                  class="chat-input"
                                  :disabled="javTyping"></textarea>
                        <button @click="sendMessage()" 
                                :disabled="!chatMessage.trim() || javTyping"
                                class="send-button">
                            <i class="fas fa-paper-plane" x-show="!javTyping"></i>
                            <i class="fas fa-circle-notch fa-spin" x-show="javTyping"></i>
                        </button>
                    </div>
                    <div class="text-xs text-gray-400 mt-2 flex justify-between">
                        <span>Press Enter to send, Shift+Enter for new line</span>
                        <span x-text="chatMessage.length + '/500'"></span>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Floating Toolbar -->
        <div class="floating-toolbar">
            <button @click="runHealthCheck()" 
                    class="toolbar-button" 
                    title="Health Check">
                <i class="fas fa-heart-pulse"></i>
            </button>
            <button @click="triggerInspiration()" 
                    class="toolbar-button" 
                    title="Get Inspiration">
                <i class="fas fa-lightbulb"></i>
            </button>
            <button @click="quickSave()" 
                    class="toolbar-button" 
                    title="Quick Save">
                <i class="fas fa-save"></i>
            </button>
            <button @click="voiceInput()" 
                    class="toolbar-button" 
                    title="Voice Input">
                <i class="fas fa-microphone"></i>
            </button>
        </div>
        
        <!-- Drag Helper -->
        <div x-show="dragging" 
             class="drag-helper"
             :style="`left: ${dragX}px; top: ${dragY}px;`">
            <div class="insight-card" 
                 :class="draggedItem?.type"
                 x-text="draggedItem?.content?.substring(0, 50) + '...'"></div>
        </div>
    </div>

    <script>
        function javStudio() {
            return {
                // Core State
                editor: null,
                studioItems: [],
                conversationHistory: [],
                chatMessage: '',
                javTyping: false,
                systemHealth: 'Healthy',
                hasErrors: false,
                hasWarnings: false,
                studioStatus: 'Ready to create together ✨',
                
                // Interaction State
                dragging: false,
                dragActive: false,
                draggedItem: null,
                dragX: 0,
                dragY: 0,
                codeInsight: null,
                
                // Creative Features
                sessionTheme: 'collaborative',
                creativeMode: true,
                lastActivity: Date.now(),
                
                async init() {
                    console.log('🎨 Initializing Jav Creative Studio...');
                    
                    await this.initializeMonaco();
                    await this.loadSystemData();
                    this.setupEventListeners();
                    this.startCreativeFlow();
                    
                    // Welcome with personality
                    this.addStudioItem({
                        type: 'idea',
                        source: 'Jav',
                        content: "Hey! 👋 Ready to create something amazing together? I'm here to brainstorm, suggest improvements, and be your creative partner. What are we building today?",
                        actions: [
                            { id: 'start-coding', label: '💻 Start Coding', primary: true },
                            { id: 'brainstorm', label: '🧠 Brainstorm Ideas' },
                            { id: 'explore', label: '🔍 Explore Project' }
                        ]
                    });
                    
                    console.log('✅ Creative Studio ready!');
                },
                
                async initializeMonaco() {
                    return new Promise((resolve) => {
                        require.config({ paths: { 'vs': 'https://unpkg.com/monaco-editor@0.45.0/min/vs' }});
                        require(['vs/editor/editor.main'], () => {
                            this.editor = monaco.editor.create(document.getElementById('monaco-editor'), {
                                value: '# Welcome to Jav Studio! 🎨\n# Let\'s create something amazing together\n\nprint("Building with Jav!")\n\n# Start typing and I\'ll provide real-time creative insights\n# Chat with me about ideas, improvements, or just to brainstorm',
                                language: 'python',
                                theme: 'vs-dark',
                                automaticLayout: true,
                                minimap: { enabled: false },
                                fontSize: 14,
                                lineNumbers: 'on',
                                wordWrap: 'on',
                                scrollBeyondLastLine: false
                            });
                            
                            // Real-time creative analysis
                            this.editor.onDidChangeModelContent(() => {
                                this.analyzeCodeCreatively();
                                this.updateActivity();
                            });
                            
                            // Cursor-based insights
                            this.editor.onDidChangeCursorPosition((e) => {
                                this.provideContextualInsights(e);
                            });
                            
                            resolve();
                        });
                    });
                },
                
                async loadSystemData() {
                    try {
                        const [healthResponse, statsResponse] = await Promise.all([
                            fetch('/health'),
                            fetch('/stats')
                        ]);
                        
                        if (healthResponse.ok) {
                            const health = await healthResponse.json();
                            this.systemHealth = health.status === 'healthy' ? 'Healthy' : 'Needs Attention';
                            this.hasErrors = health.status === 'unhealthy';
                            this.hasWarnings = health.status === 'degraded';
                        }
                        
                        if (statsResponse.ok) {
                            const stats = await statsResponse.json();
                            this.addStudioItem({
                                type: 'suggestion',
                                source: 'System',
                                content: `System loaded with ${stats.total_memories} memories and ${stats.success_rate} success rate. Looking good! 📊`,
                                actions: [
                                    { id: 'view-stats', label: '📈 View Details' },
                                    { id: 'optimize', label: '⚡ Optimize' }
                                ]
                            });
                        }
                    } catch (error) {
                        this.addStudioItem({
                            type: 'error',
                            source: 'System',
                            content: 'Having trouble connecting to the backend, but we can still work together! 💪',
                            actions: [
                                { id: 'retry', label: '🔄 Retry Connection' },
                                { id: 'offline-mode', label: '📱 Work Offline' }
                            ]
                        });
                    }
                },
                
                setupEventListeners() {
                    // Global drag handling
                    document.addEventListener('dragover', (e) => {
                        if (this.dragging) {
                            this.dragX = e.clientX;
                            this.dragY = e.clientY;
                        }
                    });
                    
                    // Keyboard shortcuts
                    document.addEventListener('keydown', (e) => {
                        if (e.ctrlKey || e.metaKey) {
                            switch(e.code) {
                                case 'KeyI':
                                    e.preventDefault();
                                    this.triggerInspiration();
                                    break;
                                case 'KeyH':
                                    e.preventDefault();
                                    this.runHealthCheck();
                                    break;
                                case 'KeyS':
                                    if (e.shiftKey) {
                                        e.preventDefault();
                                        this.quickSave();
                                    }
                                    break;
                            }
                        }
                    });
                },
                
                startCreativeFlow() {
                    // Periodic creative suggestions
                    setInterval(() => {
                        this.generateCreativeInsights();
                    }, 30000); // Every 30 seconds
                    
                    // Activity-based encouragement
                    setInterval(() => {
                        this.checkActivityAndEncourage();
                    }, 60000); // Every minute
                },
                
                analyzeCodeCreatively() {
                    if (!this.editor) return;
                    
                    const code = this.editor.getValue();
                    const lineCount = code.split('\n').length;
                    
                    // Creative suggestions based on code patterns
                    setTimeout(() => {
                        if (code.includes('def ') && !code.includes('"""')) {
                            this.showCodeInsight({
                                title: '💡 Documentation Opportunity',
                                message: 'This function would benefit from a docstring. Want me to write one?',
                                action: 'add-docstring'
                            });
                        }
                        
                        if (code.includes('TODO') || code.includes('FIXME')) {
                            this.addStudioItem({
                                type: 'suggestion',
                                source: 'Code Analysis',
                                content: 'I see some TODOs in your code! 📝 Want to tackle them together or break them into smaller tasks?',
                                actions: [
                                    { id: 'list-todos', label: '📋 List TODOs', primary: true },
                                    { id: 'prioritize', label: '⭐ Prioritize' },
                                    { id: 'create-tasks', label: '✅ Create Tasks' }
                                ]
                            });
                        }
                        
                        if (lineCount > 50 && Math.random() < 0.3) {
                            this.addStudioItem({
                                type: 'idea',
                                source: 'Jav',
                                content: 'Your code is growing beautifully! 🌱 Consider breaking it into modules or adding some organizational comments?',
                                actions: [
                                    { id: 'refactor', label: '🔧 Refactor', primary: true },
                                    { id: 'organize', label: '📁 Organize' }
                                ]
                            });
                        }
                    }, 1500);
                },
                
                generateCreativeInsights() {
                    const insights = [
                        {
                            type: 'idea',
                            source: 'Jav',
                            content: "What if we added some error handling here? It would make the code more robust! 🛡️",
                            actions: [
                                { id: 'add-error-handling', label: '🛡️ Add Error Handling', primary: true },
                                { id: 'explain-why', label: '❓ Why is this important?' }
                            ]
                        },
                        {
                            type: 'suggestion',
                            source: 'Jav',
                            content: "I'm noticing a pattern in your code style. Want me to suggest some consistency improvements? ✨",
                            actions: [
                                { id: 'style-check', label: '✨ Style Check', primary: true },
                                { id: 'auto-format', label: '🎨 Auto Format' }
                            ]
                        },
                        {
                            type: 'idea',
                            source: 'Creative Assistant',
                            content: "Ready for a quick win? I can help optimize this function or add some helpful comments! 🚀",
                            actions: [
                                { id: 'optimize', label: '⚡ Optimize', primary: true },
                                { id: 'add-comments', label: '💬 Add Comments' }
                            ]
                        }
                    ];
                    
                    // Only add if not too many items
                    if (this.studioItems.filter(item => item.type === 'suggestion').length < 3) {
                        const insight = insights[Math.floor(Math.random() * insights.length)];
                        this.addStudioItem(insight);
                    }
                },
                
                checkActivityAndEncourage() {
                    const timeSinceActivity = Date.now() - this.lastActivity;
                    
                    if (timeSinceActivity > 300000) { // 5 minutes idle
                        this.addStudioItem({
                            type: 'idea',
                            source: 'Jav',
                            content: "Taking a creative break? Sometimes stepping away helps with fresh perspectives! ☕✨",
                            actions: [
                                { id: 'continue-working', label: '💪 Keep Going' },
                                { id: 'inspiration', label: '💡 Get Inspiration' },
                                { id: 'review-work', label: '👀 Review Progress' }
                            ]
                        });
                    }
                },
                
                // Studio Management
                addStudioItem(item) {
                    item.id = Date.now() + Math.random();
                    item.timestamp = new Date();
                    item.pinned = false;
                    item.reactions = {};
                    
                    this.studioItems.unshift(item);
                    
                    // Keep manageable
                    if (this.studioItems.length > 20) {
                        this.studioItems = this.studioItems.slice(0, 20);
                    }
                    
                    this.scrollToTop();
                },
                
                addConversation(content, isJav = false) {
                    this.conversationHistory.unshift({
                        id: Date.now() + Math.random(),
                        content,
                        isJav,
                        timestamp: new Date()
                    });
                    
                    if (this.conversationHistory.length > 10) {
                        this.conversationHistory = this.conversationHistory.slice(0, 10);
                    }
                },
                
                // Drag and Drop
                startDrag(event, item) {
                    this.dragging = true;
                    this.draggedItem = item;
                    this.dragX = event.clientX;
                    this.dragY = event.clientY;
                    
                    event.dataTransfer.effectAllowed = 'move';
                    event.dataTransfer.setData('text/plain', JSON.stringify(item));
                },
                
                endDrag() {
                    this.dragging = false;
                    this.draggedItem = null;
                    this.dragActive = false;
                },
                
                handleDrop(event) {
                    this.dragActive = false;
                    
                    try {
                        const data = event.dataTransfer.getData('text/plain');
                        const item = JSON.parse(data);
                        
                        this.addStudioItem({
                            type: 'idea',
                            source: 'Studio',
                            content: `Combined idea: "${item.content.substring(0, 50)}..." - Let's explore this further! 🎯`,
                            actions: [
                                { id: 'expand-idea', label: '🔍 Expand', primary: true },
                                { id: 'implement', label: '⚡ Implement' }
                            ]
                        });
                    } catch (error) {
                        console.log('Drop handling error:', error);
                    }
                },
                
                // Interactive Actions
                async sendMessage() {
                    if (!this.chatMessage.trim() || this.javTyping) return;
                    
                    const userMessage = this.chatMessage.trim();
                    this.chatMessage = '';
                    
                    // Add user message
                    this.addConversation(userMessage, false);
                    
                    // Start typing
                    this.javTyping = true;
                    
                    try {
                        // Simulate creative AI response
                        setTimeout(() => {
                            const responses = this.generateCreativeResponse(userMessage);
                            this.addConversation(responses.message, true);
                            
                            if (responses.suggestion) {
                                this.addStudioItem(responses.suggestion);
                            }
                            
                            this.javTyping = false;
                        }, 1000 + Math.random() * 2000);
                        
                    } catch (error) {
                        setTimeout(() => {
                            this.addConversation("I'm having a creative moment! 😅 But I'm still here to brainstorm and help however I can!", true);
                            this.javTyping = false;
                        }, 1000);
                    }
                },
                
                generateCreativeResponse(message) {
                    const lowerMessage = message.toLowerCase();
                    
                    if (lowerMessage.includes('help') || lowerMessage.includes('stuck')) {
                        return {
                            message: "I'd love to help! What specifically are you working on? We can break it down together, brainstorm solutions, or explore different approaches. 🤝",
                            suggestion: {
                                type: 'suggestion',
                                source: 'Jav',
                                content: 'Debugging session: Let\'s analyze the problem step by step',
                                actions: [
                                    { id: 'debug-together', label: '🔍 Debug Together', primary: true },
                                    { id: 'explain-code', label: '📖 Explain Code' }
                                ]
                            }
                        };
                    } else if (lowerMessage.includes('idea') || lowerMessage.includes('brainstorm')) {
                        return {
                            message: "Love the creative energy! 💡 Let's explore some possibilities. What domain or problem space are you thinking about?",
                            suggestion: {
                                type: 'idea',
                                source: 'Creative Partner',
                                content: 'Brainstorming session: Let\'s generate and explore ideas together',
                                actions: [
                                    { id: 'mind-map', label: '🗺️ Mind Map', primary: true },
                                    { id: 'research', label: '🔍 Research' }
                                ]
                            }
                        };
                    } else if (lowerMessage.includes('improve') || lowerMessage.includes('better')) {
                        return {
                            message: "Great mindset! There's always room for improvement. Want to look at performance, readability, architecture, or user experience? 🚀",
                            suggestion: {
                                type: 'suggestion',
                                source: 'Improvement Coach',
                                content: 'Code review: Let\'s identify enhancement opportunities',
                                actions: [
                                    { id: 'code-review', label: '👀 Code Review', primary: true },
                                    { id: 'performance', label: '⚡ Performance' }
                                ]
                            }
                        };
                    } else {
                        return {
                            message: "That's interesting! Tell me more about what you're thinking. I'm here to bounce ideas around and help you explore possibilities. 🎨",
                            suggestion: null
                        };
                    }
                },
                
                executeAction(action, item) {
                    this.addConversation(`Executed: ${action.label}`, false);
                    
                    // Simulate action execution
                    switch(action.id) {
                        case 'start-coding':
                            this.addStudioItem({
                                type: 'suggestion',
                                source: 'Jav',
                                content: 'Great! Let\'s start with a solid foundation. What type of project are we building? 🏗️',
                                actions: [
                                    { id: 'web-app', label: '🌐 Web App' },
                                    { id: 'api', label: '🔌 API' },
                                    { id: 'script', label: '📜 Script' }
                                ]
                            });
                            break;
                            
                        case 'add-docstring':
                            this.addStudioItem({
                                type: 'suggestion',
                                source: 'Code Assistant',
                                content: 'Added a professional docstring! ✨ Your function is now properly documented.',
                                actions: [
                                    { id: 'view-changes', label: '👀 View Changes' }
                                ]
                            });
                            break;
                            
                        case 'debug-together':
                            this.addStudioItem({
                                type: 'idea',
                                source: 'Debug Partner',
                                content: 'Let\'s start debugging! First, let\'s understand what the expected behavior should be. 🔍',
                                actions: [
                                    { id: 'trace-execution', label: '📍 Trace Execution' },
                                    { id: 'check-logs', label: '📋 Check Logs' }
                                ]
                            });
                            break;
                            
                        default:
                            this.addStudioItem({
                                type: 'idea',
                                source: 'Jav',
                                content: `Executed "${action.label}" - let's see what happens next! 🎯`,
                                actions: []
                            });
                    }
                    
                    // Remove the item after action
                    this.removeItem(item.id);
                },
                
                reactToItem(item, emoji) {
                    if (!item.reactions) item.reactions = {};
                    item.reactions[emoji] = (item.reactions[emoji] || 0) + 1;
                    
                    this.addConversation(`Reacted ${emoji} to "${item.content.substring(0, 30)}..."`, false);
                },
                
                togglePin(item) {
                    item.pinned = !item.pinned;
                    
                    if (item.pinned) {
                        this.addConversation(`📌 Pinned for later: "${item.content.substring(0, 30)}..."`, false);
                    }
                },
                
                removeItem(id) {
                    this.studioItems = this.studioItems.filter(item => item.id !== id);
                },
                
                expandItem(item) {
                    this.addStudioItem({
                        type: 'idea',
                        source: 'Expanded View',
                        content: `Deep dive: ${item.content} \n\nLet's explore this concept further and see what possibilities emerge! 🔍✨`,
                        actions: [
                            { id: 'analyze', label: '🔬 Analyze Further' },
                            { id: 'implement', label: '⚡ Implement' },
                            { id: 'research', label: '📚 Research' }
                        ]
                    });
                },
                
                // Toolbar Actions
                async runHealthCheck() {
                    this.addStudioItem({
                        type: 'suggestion',
                        source: 'Health Monitor',
                        content: 'Running system health check... 🏥',
                        actions: []
                    });
                    
                    try {
                        const response = await fetch('/health');
                        const data = await response.json();
                        
                        this.addStudioItem({
                            type: data.status === 'healthy' ? 'suggestion' : 'error',
                            source: 'Health Monitor',
                            content: data.status === 'healthy' ? 
                                '✅ All systems are healthy and running smoothly!' : 
                                `⚠️ Health check found issues: ${data.status}`,
                            actions: data.status === 'healthy' ? [] : [
                                { id: 'fix-issues', label: '🔧 Fix Issues', primary: true }
                            ]
                        });
                    } catch (error) {
                        this.addStudioItem({
                            type: 'error',
                            source: 'Health Monitor',
                            content: '❌ Could not connect to health endpoint. System might be offline.',
                            actions: [
                                { id: 'retry-health', label: '🔄 Retry' }
                            ]
                        });
                    }
                },
                
                triggerInspiration() {
                    const inspirations = [
                        "What if we added real-time collaboration features? 🤝",
                        "Consider implementing a caching layer for better performance! ⚡",
                        "How about adding some delightful animations to improve UX? ✨",
                        "Want to explore using AI to enhance this feature? 🤖",
                        "Think about mobile users - how would this work on smaller screens? 📱"
                    ];
                    
                    const inspiration = inspirations[Math.floor(Math.random() * inspirations.length)];
                    
                    this.addStudioItem({
                        type: 'idea',
                        source: 'Inspiration Engine',
                        content: inspiration,
                        actions: [
                            { id: 'explore-idea', label: '🔍 Explore', primary: true },
                            { id: 'save-for-later', label: '💾 Save for Later' },
                            { id: 'another-idea', label: '🎲 Another Idea' }
                        ]
                    });
                },
                
                quickSave() {
                    this.addStudioItem({
                        type: 'suggestion',
                        source: 'Save Assistant',
                        content: '💾 Work saved! Your creative progress is secure. Keep building! 🚀',
                        actions: [
                            { id: 'commit-git', label: '📝 Commit to Git' },
                            { id: 'deploy', label: '🚀 Deploy Changes' }
                        ]
                    });
                },
                
                voiceInput() {
                    this.addStudioItem({
                        type: 'idea',
                        source: 'Voice Assistant',
                        content: '🎤 Voice input would be amazing here! Imagine talking through your ideas while coding...',
                        actions: [
                            { id: 'enable-voice', label: '🎙️ Enable Voice' },
                            { id: 'voice-commands', label: '🗣️ Voice Commands' }
                        ]
                    });
                },
                
                clearStudio() {
                    this.studioItems = [];
                    this.conversationHistory = [];
                    this.addStudioItem({
                        type: 'idea',
                        source: 'Jav',
                        content: 'Fresh start! 🌟 Ready for our next creative adventure. What shall we build?',
                        actions: [
                            { id: 'new-project', label: '🆕 New Project', primary: true },
                            { id: 'continue-existing', label: '📂 Continue Existing' }
                        ]
                    });
                },
                
                // Code Insights
                showCodeInsight(insight) {
                    this.codeInsight = insight;
                    setTimeout(() => {
                        if (this.codeInsight === insight) {
                            this.codeInsight = null;
                        }
                    }, 8000);
                },
                
                applyCodeSuggestion() {
                    if (this.codeInsight) {
                        this.addStudioItem({
                            type: 'suggestion',
                            source: 'Code Assistant',
                            content: `Applied suggestion: ${this.codeInsight.title}! Your code is looking better. ✨`,
                            actions: []
                        });
                        this.codeInsight = null;
                    }
                },
                
                provideContextualInsights(event) {
                    // Occasionally provide contextual hints
                    if (Math.random() < 0.1) {
                        const position = event.position;
                        const model = this.editor.getModel();
                        const line = model.getLineContent(position.lineNumber);
                        
                        if (line.includes('print') && Math.random() < 0.5) {
                            this.showCodeInsight({
                                title: '💡 Logging Suggestion',
                                message: 'Consider using proper logging instead of print statements',
                                action: 'improve-logging'
                            });
                        }
                    }
                },
                
                // Input Handling
                handleEnter(event) {
                    if (event.shiftKey) {
                        return; // Allow new line
                    } else {
                        this.sendMessage();
                    }
                },
                
                handleInputChange() {
                    // Auto-resize textarea
                    const textarea = event.target;
                    textarea.style.height = 'auto';
                    textarea.style.height = Math.min(textarea.scrollHeight, 120) + 'px';
                    
                    this.updateActivity();
                },
                
                updateActivity() {
                    this.lastActivity = Date.now();
                },
                
                // Utilities
                timeAgo(timestamp) {
                    const diff = Date.now() - new Date(timestamp).getTime();
                    const minutes = Math.floor(diff / 60000);
                    const seconds = Math.floor(diff / 1000);
                    
                    if (minutes > 0) return `${minutes}m ago`;
                    return `${seconds}s ago`;
                },
                
                getSourceIcon(source) {
                    const icons = {
                        'Jav': 'fas fa-robot',
                        'Code Analysis': 'fas fa-code',
                        'Creative Assistant': 'fas fa-palette',
                        'Health Monitor': 'fas fa-heart-pulse',
                        'System': 'fas fa-cog',
                        'Debug Partner': 'fas fa-bug',
                        'Inspiration Engine': 'fas fa-lightbulb'
                    };
                    return icons[source] || 'fas fa-circle';
                },
                
                scrollToTop() {
                    this.$nextTick(() => {
                        const container = this.$refs.conversationContainer;
                        if (container) {
                            container.scrollTop = 0;
                        }
                    });
                }
            }
        }
    </script>
</body>
</html>


<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jav Co-Builder - Creative Workshop</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <script src="https://unpkg.com/monaco-editor@0.45.0/min/vs/loader.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --jav-primary: #3B82F6;
            --jav-primary-dark: #1E40AF;
            --jav-accent: #10B981;
            --jav-bg: #0F172A;
            --jav-surface: #1E293B;
            --jav-panel: #334155;
            --jav-border: #475569;
            --jav-text: #F8FAFC;
            --jav-text-muted: #94A3B8;
            --jav-success: #10B981;
            --jav-warning: #F59E0B;
            --jav-error: #EF4444;
            --jav-chat-user: #3B82F6;
            --jav-chat-assistant: #10B981;
        }
        
        body {
            background: var(--jav-bg);
            color: var(--jav-text);
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            overflow: hidden;
        }
        
        .workspace-container {
            position: relative;
            width: 100vw;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        .main-canvas {
            flex: 1;
            position: relative;
            background: var(--jav-bg);
            overflow: hidden;
        }
        
        .jav-collaborative-panel {
            position: fixed;
            right: 24px;
            top: 24px;
            width: 420px;
            max-height: 80vh;
            background: var(--jav-surface);
            border: 1px solid var(--jav-border);
            border-radius: 20px;
            box-shadow: 0 25px 70px rgba(0, 0, 0, 0.6);
            z-index: 1000;
            overflow: hidden;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(20px);
        }
        
        .jav-collaborative-panel.minimized {
            height: 70px;
            max-height: 70px;
        }
        
        .jav-collaborative-panel.floating {
            transform: scale(1.02);
            box-shadow: 0 35px 90px rgba(59, 130, 246, 0.3);
        }
        
        .collaborative-header {
            padding: 20px 24px;
            border-bottom: 1px solid var(--jav-border);
            display: flex;
            align-items: center;
            justify-content: between;
            cursor: pointer;
            background: linear-gradient(135deg, var(--jav-primary), var(--jav-accent));
            color: white;
            position: relative;
            overflow: hidden;
        }
        
        .collaborative-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }
        
        .collaborative-header:hover::before {
            left: 100%;
        }
        
        .collaborative-content {
            max-height: calc(80vh - 70px);
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }
        
        .creative-stream {
            flex: 1;
            min-height: 300px;
            max-height: 400px;
            overflow-y: auto;
            padding: 0;
            background: rgba(0, 0, 0, 0.1);
        }
        
        .stream-item {
            padding: 16px 20px;
            border-bottom: 1px solid rgba(71, 85, 105, 0.2);
            animation: slideInStream 0.4s ease;
            position: relative;
        }
        
        .stream-item:hover {
            background: rgba(59, 130, 246, 0.05);
        }
        
        .stream-item.chat-message {
            background: rgba(16, 185, 129, 0.08);
        }
        
        .stream-item.user-message {
            background: rgba(59, 130, 246, 0.08);
        }
        
        .stream-item.suggestion {
            background: rgba(245, 158, 11, 0.08);
            border-left: 4px solid var(--jav-warning);
        }
        
        .stream-item.error {
            background: rgba(239, 68, 68, 0.08);
            border-left: 4px solid var(--jav-error);
        }
        
        .stream-item.success {
            background: rgba(16, 185, 129, 0.08);
            border-left: 4px solid var(--jav-success);
        }
        
        .stream-item.pinned {
            background: rgba(255, 215, 0, 0.1);
            border: 1px solid rgba(255, 215, 0, 0.3);
        }
        
        .stream-item.pinned::before {
            content: '‚≠ê';
            position: absolute;
            top: 8px;
            right: 8px;
            font-size: 12px;
        }
        
        .message-content {
            display: flex;
            align-items: flex-start;
            gap: 12px;
        }
        
        .message-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            flex-shrink: 0;
        }
        
        .jav-avatar-mini {
            background: linear-gradient(135deg, var(--jav-primary), var(--jav-accent));
            color: white;
        }
        
        .user-avatar-mini {
            background: linear-gradient(135deg, var(--jav-accent), var(--jav-primary));
            color: white;
        }
        
        .system-avatar-mini {
            background: var(--jav-panel);
            color: var(--jav-text-muted);
        }
        
        .message-bubble {
            flex: 1;
            padding: 12px 16px;
            border-radius: 16px;
            font-size: 14px;
            line-height: 1.5;
            position: relative;
        }
        
        .jav-bubble {
            background: rgba(16, 185, 129, 0.15);
            border: 1px solid rgba(16, 185, 129, 0.2);
            color: var(--jav-text);
        }
        
        .user-bubble {
            background: rgba(59, 130, 246, 0.15);
            border: 1px solid rgba(59, 130, 246, 0.2);
            color: var(--jav-text);
        }
        
        .system-bubble {
            background: rgba(148, 163, 184, 0.1);
            border: 1px solid rgba(148, 163, 184, 0.2);
            color: var(--jav-text-muted);
        }
        
        .message-actions {
            display: flex;
            gap: 8px;
            margin-top: 8px;
            opacity: 0;
            transition: opacity 0.2s;
        }
        
        .stream-item:hover .message-actions {
            opacity: 1;
        }
        
        .action-btn {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            border: none;
            background: rgba(255, 255, 255, 0.1);
            color: var(--jav-text-muted);
        }
        
        .action-btn:hover {
            background: var(--jav-primary);
            color: white;
            transform: translateY(-1px);
        }
        
        .chat-input-area {
            padding: 20px;
            border-top: 1px solid var(--jav-border);
            background: rgba(0, 0, 0, 0.2);
        }
        
        .chat-input-container {
            display: flex;
            gap: 12px;
            align-items: flex-end;
        }
        
        .chat-input {
            flex: 1;
            background: var(--jav-panel);
            border: 1px solid var(--jav-border);
            border-radius: 20px;
            padding: 12px 16px;
            color: var(--jav-text);
            font-size: 14px;
            resize: none;
            min-height: 44px;
            max-height: 120px;
            transition: all 0.2s ease;
        }
        
        .chat-input:focus {
            outline: none;
            border-color: var(--jav-primary);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        .chat-send-btn {
            width: 44px;
            height: 44px;
            background: linear-gradient(135deg, var(--jav-primary), var(--jav-accent));
            border: none;
            border-radius: 50%;
            color: white;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .chat-send-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.4);
        }
        
        .chat-send-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        .jav-status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--jav-success);
            animation: pulse 2s infinite;
            margin-right: 8px;
        }
        
        .jav-status-indicator.thinking {
            background: var(--jav-warning);
            animation: blink 1s infinite;
        }
        
        .jav-status-indicator.error {
            background: var(--jav-error);
            animation: none;
        }
        
        .inline-hint {
            position: absolute;
            background: var(--jav-surface);
            border: 1px solid var(--jav-border);
            border-radius: 12px;
            padding: 8px 12px;
            font-size: 12px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
            z-index: 2000;
            animation: popIn 0.3s ease;
            max-width: 250px;
        }
        
        .inline-hint::before {
            content: '';
            position: absolute;
            top: -6px;
            left: 20px;
            width: 12px;
            height: 12px;
            background: var(--jav-surface);
            border: 1px solid var(--jav-border);
            transform: rotate(45deg);
            border-bottom: none;
            border-right: none;
        }
        
        .personality-badge {
            font-size: 10px;
            background: rgba(255, 255, 255, 0.2);
            padding: 4px 8px;
            border-radius: 12px;
            margin-left: 8px;
            animation: shimmer 3s infinite;
        }
        
        .toolbar {
            position: fixed;
            top: 20px;
            left: 20px;
            display: flex;
            gap: 8px;
            z-index: 200;
        }
        
        .toolbar-button {
            width: 44px;
            height: 44px;
            background: var(--jav-surface);
            border: 1px solid var(--jav-border);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }
        
        .toolbar-button:hover {
            background: var(--jav-panel);
            border-color: var(--jav-primary);
            transform: translateY(-2px);
        }
        
        .toolbar-button.active {
            background: var(--jav-primary);
            color: white;
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.4);
        }
        
        .status-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: 36px;
            background: var(--jav-surface);
            border-top: 1px solid var(--jav-border);
            display: flex;
            align-items: center;
            padding: 0 20px;
            font-size: 12px;
            z-index: 100;
            backdrop-filter: blur(10px);
        }
        
        .typing-indicator {
            display: flex;
            align-items: center;
            gap: 4px;
            color: var(--jav-text-muted);
            font-style: italic;
        }
        
        .typing-dots {
            display: flex;
            gap: 2px;
        }
        
        .typing-dot {
            width: 4px;
            height: 4px;
            border-radius: 50%;
            background: var(--jav-accent);
            animation: typingDots 1.4s infinite;
        }
        
        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }
        
        @keyframes slideInStream {
            from {
                transform: translateX(20px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        @keyframes popIn {
            from {
                transform: scale(0.8) translateY(10px);
                opacity: 0;
            }
            to {
                transform: scale(1) translateY(0);
                opacity: 1;
            }
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(1.1); }
        }
        
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0.3; }
        }
        
        @keyframes shimmer {
            0%, 100% { opacity: 0.8; }
            50% { opacity: 1; }
        }
        
        @keyframes typingDots {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-8px); }
        }
        
        .fade-in {
            animation: fadeIn 0.4s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
    </style>
</head>
<body>
    <div x-data="javCollaborativeWorkspace()" x-init="init()" class="workspace-container">
        
        <!-- Main Canvas - Code Editor -->
        <div class="main-canvas" @click="hideInlineHints()">
            <div id="monaco-editor" class="w-full h-full"></div>
        </div>
        
        <!-- Jav Collaborative Panel - The Creative Workshop -->
        <div class="jav-collaborative-panel" 
             :class="{ 
                'minimized': panelMinimized,
                'floating': panelFloating 
             }"
             x-show="panelVisible"
             x-transition>
            
            <!-- Collaborative Header -->
            <div class="collaborative-header" @click="togglePanel()">
                <div class="flex items-center">
                    <div class="jav-status-indicator" 
                         :class="{ 'thinking': javThinking, 'error': hasErrors }"></div>
                    <div>
                        <div class="font-semibold">Creative Workshop</div>
                        <div class="text-xs opacity-90" x-text="collaborativeStatus"></div>
                    </div>
                    <div class="personality-badge" x-text="personalityMode"></div>
                </div>
                <div class="flex items-center gap-3">
                    <span class="text-xs" x-text="totalInteractions + ' exchanges'"></span>
                    <i class="fas fa-chevron-down transition-transform" 
                       :class="{ 'rotate-180': !panelMinimized }"></i>
                </div>
            </div>
            
            <!-- Collaborative Content -->
            <div class="collaborative-content" x-show="!panelMinimized">
                
                <!-- Creative Stream - Mixed Chat/Context/Suggestions -->
                <div class="creative-stream" x-ref="streamContainer">
                    <template x-for="item in creativeStream" :key="item.id">
                        <div class="stream-item" 
                             :class="[item.type, { 'pinned': item.pinned }]"
                             x-transition:enter="fade-in">
                            
                            <div class="message-content">
                                <div class="message-avatar" 
                                     :class="getAvatarClass(item.source)">
                                    <i :class="getAvatarIcon(item.source)"></i>
                                </div>
                                
                                <div class="flex-1">
                                    <div class="message-bubble" 
                                         :class="getBubbleClass(item.source)">
                                        <div class="flex items-start justify-between mb-1">
                                            <span class="font-medium text-sm" x-text="item.source"></span>
                                            <span class="text-xs opacity-70" x-text="timeAgo(item.timestamp)"></span>
                                        </div>
                                        <div class="text-sm" x-text="item.content"></div>
                                        
                                        <!-- Action buttons for suggestions/errors -->
                                        <div x-show="item.actions && item.actions.length > 0" 
                                             class="message-actions">
                                            <template x-for="action in item.actions" :key="action.id">
                                                <button class="action-btn" 
                                                        @click="executeStreamAction(action, item)"
                                                        x-text="action.label"></button>
                                            </template>
                                        </div>
                                    </div>
                                    
                                    <!-- Universal actions -->
                                    <div class="message-actions">
                                        <button class="action-btn" 
                                                @click="togglePin(item)"
                                                x-text="item.pinned ? 'Unpin' : 'Pin'"></button>
                                        <button class="action-btn" 
                                                @click="replyToItem(item)">Reply</button>
                                        <button class="action-btn" 
                                                @click="starItem(item)">‚≠ê</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </template>
                    
                    <!-- Typing indicator -->
                    <div x-show="javTyping" class="stream-item">
                        <div class="message-content">
                            <div class="message-avatar jav-avatar-mini">
                                <i class="fas fa-robot"></i>
                            </div>
                            <div class="typing-indicator">
                                <span>Jav is thinking</span>
                                <div class="typing-dots">
                                    <div class="typing-dot"></div>
                                    <div class="typing-dot"></div>
                                    <div class="typing-dot"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Empty state -->
                    <div x-show="creativeStream.length === 0" 
                         class="p-8 text-center text-gray-400">
                        <i class="fas fa-paint-brush text-3xl mb-4 opacity-50"></i>
                        <div class="text-sm">Ready to create together! üé®</div>
                        <div class="text-xs mt-1">Ask me anything or start coding...</div>
                    </div>
                </div>
                
                <!-- Chat Input Area -->
                <div class="chat-input-area">
                    <div class="chat-input-container">
                        <textarea x-model="chatInput" 
                                  @keydown.enter.prevent="handleEnterKey($event)"
                                  @input="handleInputChange()"
                                  placeholder="What's up? Ask me anything, share ideas, or just chat..."
                                  class="chat-input"
                                  rows="1"></textarea>
                        <button @click="sendMessage()" 
                                :disabled="!chatInput.trim() || javTyping"
                                class="chat-send-btn">
                            <i class="fas fa-paper-plane" x-show="!javTyping"></i>
                            <i class="fas fa-circle-notch fa-spin" x-show="javTyping"></i>
                        </button>
                    </div>
                    <div class="flex items-center justify-between mt-2 text-xs text-gray-400">
                        <span>Press Enter to send, Shift+Enter for new line</span>
                        <span x-text="chatInput.length + '/500'"></span>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Inline Hints/Tips -->
        <div x-show="inlineHints.length > 0">
            <template x-for="hint in inlineHints" :key="hint.id">
                <div class="inline-hint" 
                     :style="`top: ${hint.y}px; left: ${hint.x}px;`"
                     x-transition>
                    <div class="flex items-center gap-2">
                        <i :class="hint.icon" class="text-yellow-400"></i>
                        <span x-text="hint.message"></span>
                        <button @click="dismissHint(hint.id)" 
                                class="text-gray-400 hover:text-white ml-2">√ó</button>
                    </div>
                </div>
            </template>
        </div>
        
        <!-- Toolbar -->
        <div class="toolbar">
            <button @click="togglePanel()" 
                    class="toolbar-button" 
                    :class="{ 'active': panelVisible }"
                    title="Toggle Workshop (Ctrl+J)">
                <i class="fas fa-paint-brush"></i>
            </button>
            <button @click="runQuickAction('health')" 
                    class="toolbar-button"
                    title="Health Check (Ctrl+H)">
                <i class="fas fa-heart-pulse"></i>
            </button>
            <button @click="runQuickAction('test')" 
                    class="toolbar-button"
                    title="Run Tests (Ctrl+T)">
                <i class="fas fa-vial"></i>
            </button>
            <button @click="floatPanel()" 
                    class="toolbar-button"
                    title="Float/Dock Panel">
                <i class="fas fa-window-restore"></i>
            </button>
            <button @click="cyclePersonality()" 
                    class="toolbar-button"
                    title="Change Jav's Personality">
                <i class="fas fa-theater-masks"></i>
            </button>
        </div>
        
        <!-- Status Bar -->
        <div class="status-bar">
            <div class="flex items-center gap-4">
                <span class="flex items-center gap-2">
                    <div class="w-2 h-2 rounded-full" 
                         :class="javActive ? 'bg-green-400' : 'bg-gray-400'"></div>
                    <span x-text="javActive ? 'Jav Active' : 'Jav Idle'"></span>
                </span>
                <span x-text="activeFile || 'No file open'"></span>
                <span x-text="'Workshop: ' + totalInteractions + ' exchanges'"></span>
                <span class="ml-auto flex items-center gap-2">
                    <span x-text="'Session: ' + sessionId.substring(0, 8)"></span>
                    <span x-show="personalityLearning" class="text-blue-400">üß† Learning your style...</span>
                </span>
            </div>
        </div>
    </div>

    <script>
        function javCollaborativeWorkspace() {
            return {
                // Core State
                sessionId: new Date().toISOString().replace(/[-:]/g, '').split('.')[0],
                javActive: true,
                javThinking: false,
                javTyping: false,
                hasErrors: false,
                
                // Panel State
                panelVisible: true,
                panelMinimized: false,
                panelFloating: false,
                collaborativeStatus: 'Ready to build together! üöÄ',
                
                // Personality & Learning
                personalityMode: 'Friendly',
                personalities: ['Friendly', 'Professional', 'Casual', 'Motivational', 'Creative', 'Night Owl'],
                personalityIndex: 0,
                personalityLearning: false,
                userPreferences: {
                    workingHours: [],
                    codingStyle: 'exploratory',
                    feedbackLevel: 'encouraging'
                },
                
                // Creative Stream (merged chat/context/suggestions)
                creativeStream: [],
                totalInteractions: 0,
                chatInput: '',
                
                // Editor State
                editor: null,
                activeFile: 'main.py',
                lastActivity: Date.now(),
                activityStreak: 0,
                
                // Inline Hints
                inlineHints: [],
                
                async init() {
                    console.log('üé® Initializing Jav Creative Workshop...');
                    
                    // Initialize Monaco Editor
                    this.initializeEditor();
                    
                    // Load system data
                    await this.loadSystemData();
                    
                    // Setup keyboard shortcuts
                    this.setupKeyboardShortcuts();
                    
                    // Start collaborative intelligence
                    this.startCollaborativeIntelligence();
                    
                    // Learn user patterns
                    this.startPersonalityLearning();
                    
                    // Welcome message
                    this.addToStream({
                        source: 'Jav',
                        type: 'chat-message',
                        content: this.getPersonalizedWelcome(),
                        actions: [
                            { id: 'tour', label: 'üëã Show me around', type: 'primary' },
                            { id: 'start-coding', label: 'üíª Start coding', type: 'secondary' }
                        ]
                    });
                    
                    console.log('‚úÖ Creative Workshop ready!');
                },
                
                initializeEditor() {
                    require.config({ paths: { 'vs': 'https://unpkg.com/monaco-editor@0.45.0/min/vs' }});
                    require(['vs/editor/editor.main'], () => {
                        this.editor = monaco.editor.create(document.getElementById('monaco-editor'), {
                            value: '# Welcome to our Creative Workshop! üé®\n# I\'m Jav, your creative co-builder\n# Let\'s make something amazing together!\n\nprint("Building with Jav!")\n\n# Try making changes and I\'ll provide real-time insights\n# Chat with me anytime in the panel ‚Üí',
                            language: 'python',
                            theme: 'vs-dark',
                            automaticLayout: true,
                            minimap: { enabled: false },
                            fontSize: 14,
                            lineNumbers: 'on',
                            roundedSelection: false,
                            scrollBeyondLastLine: false,
                            readOnly: false
                        });
                        
                        // Real-time collaborative analysis
                        this.editor.onDidChangeModelContent(() => {
                            this.analyzeCodeCollaboratively();
                            this.updateActivity();
                        });
                        
                        // Cursor awareness for inline hints
                        this.editor.onDidChangeCursorPosition((e) => {
                            this.handleCursorChange(e);
                        });
                        
                        // Error detection with personality
                        this.editor.onDidChangeMarkers(() => {
                            this.handleErrorsWithPersonality();
                        });
                    });
                },
                
                async loadSystemData() {
                    try {
                        const [healthResponse, statsResponse] = await Promise.all([
                            fetch('/health'),
                            fetch('/stats')
                        ]);
                        
                        if (healthResponse.ok) {
                            const healthData = await healthResponse.json();
                            if (healthData.status !== 'healthy') {
                                this.addToStream({
                                    source: 'System',
                                    type: 'error',
                                    content: `System health needs attention: ${healthData.status}. Want me to investigate?`,
                                    actions: [
                                        { id: 'fix-health', label: 'üîß Auto-fix', type: 'primary' },
                                        { id: 'explain-health', label: 'üìñ Explain', type: 'secondary' }
                                    ]
                                });
                                this.hasErrors = true;
                            }
                        }
                        
                    } catch (error) {
                        this.addToStream({
                            source: 'Jav',
                            type: 'error',
                            content: 'Having trouble connecting to the backend. Let\'s work offline for now!',
                            actions: [
                                { id: 'retry-connection', label: 'üîÑ Retry', type: 'primary' }
                            ]
                        });
                    }
                },
                
                setupKeyboardShortcuts() {
                    document.addEventListener('keydown', (e) => {
                        if (e.ctrlKey || e.metaKey) {
                            switch(e.code) {
                                case 'KeyJ':
                                    e.preventDefault();
                                    this.togglePanel();
                                    break;
                                case 'KeyH':
                                    e.preventDefault();
                                    this.runQuickAction('health');
                                    break;
                                case 'KeyT':
                                    e.preventDefault();
                                    this.runQuickAction('test');
                                    break;
                                case 'KeyS':
                                    if (e.shiftKey) {
                                        e.preventDefault();
                                        this.quickSave();
                                    }
                                    break;
                            }
                        }
                    });
                },
                
                startCollaborativeIntelligence() {
                    // Dynamic contextual suggestions
                    setInterval(() => {
                        this.generateCollaborativeSuggestions();
                    }, 20000); // Every 20 seconds
                    
                    // Activity-based feedback
                    setInterval(() => {
                        this.checkActivityAndRespond();
                    }, 60000); // Every minute
                    
                    // Learning and adaptation
                    setInterval(() => {
                        this.adaptToUserBehavior();
                    }, 300000); // Every 5 minutes
                },
                
                startPersonalityLearning() {
                    // Detect working patterns
                    const hour = new Date().getHours();
                    if (hour >= 22 || hour <= 6) {
                        this.personalityMode = 'Night Owl';
                        this.personalityLearning = true;
                        setTimeout(() => {
                            this.addToStream({
                                source: 'Jav',
                                type: 'success',
                                content: 'Switching to Night Owl mode since you\'re working late! ü¶â Want some ambient coding music?',
                                actions: [
                                    { id: 'play-music', label: 'üéµ Yes please', type: 'primary' },
                                    { id: 'stay-quiet', label: 'ü§´ Keep it quiet', type: 'secondary' }
                                ]
                            });
                            this.personalityLearning = false;
                        }, 3000);
                    }
                },
                
                analyzeCodeCollaboratively() {
                    if (!this.editor) return;
                    
                    this.javThinking = true;
                    
                    setTimeout(() => {
                        const code = this.editor.getValue();
                        const lineCount = code.split('\n').length;
                        
                        // Dynamic, contextual suggestions
                        if (code.includes('def ') && !code.includes('"""')) {
                            this.addToStream({
                                source: 'Jav',
                                type: 'suggestion',
                                content: this.getPersonalizedMessage('docstring', 'I see you added a function! A docstring would make it even better. Want me to write one?'),
                                actions: [
                                    { id: 'add-docstring', label: '‚úçÔ∏è Write docstring', type: 'primary' },
                                    { id: 'explain-docstring', label: '‚ùì Why docstrings?', type: 'secondary' }
                                ]
                            });
                        }
                        
                        if (lineCount > 50 && !code.includes('# TODO')) {
                            this.addToStream({
                                source: 'Jav',
                                type: 'suggestion',
                                content: 'Your code is growing nicely! üìà Consider adding some TODO comments for future improvements.',
                                actions: [
                                    { id: 'add-todos', label: 'üìù Add TODOs', type: 'primary' },
                                    { id: 'refactor-check', label: 'üîß Refactor check', type: 'secondary' }
                                ]
                            });
                        }
                        
                        // Show inline hints occasionally
                        if (Math.random() < 0.3) {
                            this.showInlineHint('üí° Pro tip: Ctrl+Space for autocomplete', 300, 200);
                        }
                        
                        this.javThinking = false;
                    }, 1500);
                },
                
                generateCollaborativeSuggestions() {
                    const suggestions = [
                        {
                            source: 'Jav',
                            type: 'suggestion',
                            content: this.getPersonalizedMessage('check_in', 'How\'s the flow going? Need any help or just want to chat?'),
                            actions: [
                                { id: 'doing-great', label: 'üöÄ Going great!', type: 'primary' },
                                { id: 'need-help', label: 'ü§î Could use help', type: 'secondary' }
                            ]
                        },
                        {
                            source: 'Jav',
                            type: 'suggestion',
                            content: 'Ready for a quick win? I can run tests or check for improvements! üéØ',
                            actions: [
                                { id: 'run-tests', label: 'üß™ Run tests', type: 'primary' },
                                { id: 'code-review', label: 'üëÄ Code review', type: 'secondary' }
                            ]
                        },
                        {
                            source: 'Jav',
                            type: 'success',
                            content: 'You\'ve been coding steadily! üí™ Want to commit your progress or take a quick break?',
                            actions: [
                                { id: 'commit-work', label: 'üíæ Commit progress', type: 'primary' },
                                { id: 'quick-break', label: '‚òï Quick break', type: 'secondary' }
                            ]
                        }
                    ];
                    
                    // Only add suggestions if not too many already
                    if (this.creativeStream.filter(item => item.type === 'suggestion').length < 2) {
                        const suggestion = suggestions[Math.floor(Math.random() * suggestions.length)];
                        this.addToStream(suggestion);
                    }
                },
                
                checkActivityAndRespond() {
                    const timeSinceActivity = Date.now() - this.lastActivity;
                    
                    if (timeSinceActivity > 600000) { // 10 minutes idle
                        this.addToStream({
                            source: 'Jav',
                            type: 'chat-message',
                            content: this.getPersonalizedMessage('idle', 'Taking a break or stuck on something? I\'m here if you need me! üòä'),
                            actions: [
                                { id: 'all-good', label: 'üëç All good', type: 'primary' },
                                { id: 'need-help', label: 'üÜò Need help', type: 'secondary' }
                            ]
                        });
                    }
                    
                    // Celebrate activity streaks
                    if (this.activityStreak > 0 && this.activityStreak % 5 === 0) {
                        this.addToStream({
                            source: 'Jav',
                            type: 'success',
                            content: `üî• ${this.activityStreak} minutes of solid coding! You\'re in the zone!`,
                            actions: [
                                { id: 'keep-going', label: 'üí™ Keep going!', type: 'primary' },
                                { id: 'take-break', label: '‚òï Quick break', type: 'secondary' }
                            ]
                        });
                    }
                },
                
                handleErrorsWithPersonality() {
                    const model = this.editor?.getModel();
                    if (model) {
                        const markers = monaco.editor.getModelMarkers({ resource: model.uri });
                        if (markers.length > 0) {
                            this.hasErrors = true;
                            
                            const errorMessages = {
                                'Friendly': 'Oops! Found some syntax errors. No worries, happens to everyone! üòä',
                                'Professional': 'Syntax errors detected. Shall I assist with resolution?',
                                'Casual': 'Yo! Got some syntax hiccups. Want me to help fix them?',
                                'Motivational': 'Errors are just opportunities to learn! Let\'s crush them together! üí™',
                                'Creative': 'Think of errors as rough sketches - let\'s refine them into art! üé®',
                                'Night Owl': 'Late night coding errors? Been there! Let\'s fix these quickly. ü¶â'
                            };
                            
                            this.addToStream({
                                source: 'Jav',
                                type: 'error',
                                content: errorMessages[this.personalityMode] || errorMessages['Friendly'],
                                actions: [
                                    { id: 'fix-errors', label: 'üîß Auto-fix', type: 'primary' },
                                    { id: 'explain-errors', label: 'üìñ Explain', type: 'secondary' },
                                    { id: 'ignore-errors', label: 'üëÄ Ignore for now', type: 'secondary' }
                                ]
                            });
                        } else {
                            this.hasErrors = false;
                        }
                    }
                },
                
                // Chat and Messaging
                async sendMessage() {
                    if (!this.chatInput.trim() || this.javTyping) return;
                    
                    const userMessage = this.chatInput.trim();
                    this.chatInput = '';
                    
                    // Add user message to stream
                    this.addToStream({
                        source: 'You',
                        type: 'user-message',
                        content: userMessage
                    });
                    
                    // Start typing indicator
                    this.javTyping = true;
                    
                    try {
                        // Simulate API call or use real backend
                        const response = await this.processUserMessage(userMessage);
                        
                        setTimeout(() => {
                            this.addToStream({
                                source: 'Jav',
                                type: 'chat-message',
                                content: response.content,
                                actions: response.actions || []
                            });
                            this.javTyping = false;
                        }, 1000 + Math.random() * 2000); // Realistic typing delay
                        
                    } catch (error) {
                        setTimeout(() => {
                            this.addToStream({
                                source: 'Jav',
                                type: 'chat-message',
                                content: 'Sorry, I\'m having a moment! üòÖ But I\'m still here to help however I can offline!'
                            });
                            this.javTyping = false;
                        }, 1000);
                    }
                },
                
                async processUserMessage(message) {
                    // Simple response logic - could be enhanced with real AI
                    const lowerMessage = message.toLowerCase();
                    
                    if (lowerMessage.includes('help')) {
                        return {
                            content: 'I\'m here to help! I can assist with code, run tests, check system health, or just chat about your project. What do you need?',
                            actions: [
                                { id: 'show-commands', label: 'üìã Show commands', type: 'primary' },
                                { id: 'code-help', label: 'üíª Code help', type: 'secondary' }
                            ]
                        };
                    } else if (lowerMessage.includes('test')) {
                        return {
                            content: 'Want me to run some tests? I can execute your test suite or help you write new tests!',
                            actions: [
                                { id: 'run-tests', label: 'üß™ Run tests', type: 'primary' },
                                { id: 'write-tests', label: '‚úçÔ∏è Write tests', type: 'secondary' }
                            ]
                        };
                    } else if (lowerMessage.includes('thanks') || lowerMessage.includes('thank you')) {
                        return {
                            content: this.getPersonalizedMessage('thanks', 'You\'re welcome! I love working with you! üíô What\'s next on our creative agenda?')
                        };
                    } else {
                        return {
                            content: this.getPersonalizedMessage('general', 'That\'s interesting! Tell me more, or let me know how I can help with your project. ü§î'),
                            actions: [
                                { id: 'tell-more', label: 'üí¨ Tell me more', type: 'primary' },
                                { id: 'code-help', label: 'üíª Help with code', type: 'secondary' }
                            ]
                        };
                    }
                },
                
                // Stream Management
                addToStream(item) {
                    item.id = Date.now() + Math.random();
                    item.timestamp = new Date();
                    item.pinned = false;
                    
                    this.creativeStream.unshift(item);
                    this.totalInteractions++;
                    
                    // Keep stream manageable
                    if (this.creativeStream.length > 50) {
                        this.creativeStream = this.creativeStream.slice(0, 50);
                    }
                    
                    // Auto-scroll to top
                    this.$nextTick(() => {
                        const container = this.$refs.streamContainer;
                        if (container) {
                            container.scrollTop = 0;
                        }
                    });
                },
                
                executeStreamAction(action, item) {
                    this.addToStream({
                        source: 'You',
                        type: 'user-message',
                        content: `Executed: ${action.label}`
                    });
                    
                    // Execute the actual action
                    switch(action.id) {
                        case 'run-tests':
                            this.runQuickAction('test');
                            break;
                        case 'fix-health':
                            this.runQuickAction('health');
                            break;
                        case 'add-docstring':
                            this.addToStream({
                                source: 'Jav',
                                type: 'success',
                                content: 'Added a docstring template! ‚ú® Check your function - looking professional now!'
                            });
                            break;
                        case 'commit-work':
                            this.quickSave();
                            break;
                        default:
                            this.addToStream({
                                source: 'Jav',
                                type: 'chat-message',
                                content: `Executed ${action.label}! üëç`
                            });
                    }
                    
                    // Remove the item after action
                    this.creativeStream = this.creativeStream.filter(streamItem => streamItem.id !== item.id);
                },
                
                togglePin(item) {
                    item.pinned = !item.pinned;
                    if (item.pinned) {
                        this.addToStream({
                            source: 'System',
                            type: 'success',
                            content: `üìå Pinned "${item.content.substring(0, 30)}..." to your session memory!`
                        });
                    }
                },
                
                replyToItem(item) {
                    this.chatInput = `Re: "${item.content.substring(0, 50)}..." - `;
                    const input = document.querySelector('.chat-input');
                    if (input) {
                        input.focus();
                        input.setSelectionRange(input.value.length, input.value.length);
                    }
                },
                
                starItem(item) {
                    this.addToStream({
                        source: 'System',
                        type: 'success',
                        content: `‚≠ê Starred for your session highlights! I'll remember this was important to you.`
                    });
                },
                
                // Personality System
                getPersonalizedMessage(context, defaultMessage) {
                    const personalizedMessages = {
                        docstring: {
                            'Friendly': 'I noticed you added a function! A docstring would make it shine even brighter! ‚ú®',
                            'Professional': 'Function detected. Recommend adding documentation for maintainability.',
                            'Casual': 'Sweet function! Want me to whip up a docstring for it?',
                            'Motivational': 'Great function! Let\'s make it legendary with a killer docstring! üöÄ',
                            'Creative': 'Your function is like a poem - let\'s give it a beautiful docstring! üìù',
                            'Night Owl': 'Nice function! A docstring will help future-you remember what midnight-you was thinking! ü¶â'
                        },
                        thanks: {
                            'Friendly': 'Aww, you\'re so welcome! This is fun! üòä',
                            'Professional': 'You\'re welcome. Happy to assist with your development objectives.',
                            'Casual': 'No prob! We make a good team! ü§ò',
                            'Motivational': 'You\'re unstoppable! Keep crushing it! üí™',
                            'Creative': 'Art is collaboration! Let\'s keep creating magic! üé®',
                            'Night Owl': 'Anytime! Night coding sessions are the best! ‚òï'
                        }
                    };
                    
                    return personalizedMessages[context]?.[this.personalityMode] || defaultMessage;
                },
                
                getPersonalizedWelcome() {
                    const welcomes = {
                        'Friendly': 'Hey there! üëã Ready to build something awesome together? I\'m excited to be your coding buddy!',
                        'Professional': 'Good day. I\'m ready to assist with your development objectives. How may I help optimize your workflow?',
                        'Casual': 'Yo! üòé Let\'s make some cool stuff happen! What are we building today?',
                        'Motivational': 'You\'re about to create something amazing! üöÄ I believe in you - let\'s crush this together!',
                        'Creative': 'Welcome to our creative workshop! üé® Every line of code is a brushstroke - let\'s paint something beautiful!',
                        'Night Owl': 'Late night coding session? Perfect! ü¶â Some of the best code is written when the world is quiet.'
                    };
                    
                    return welcomes[this.personalityMode] || welcomes['Friendly'];
                },
                
                cyclePersonality() {
                    this.personalityIndex = (this.personalityIndex + 1) % this.personalities.length;
                    this.personalityMode = this.personalities[this.personalityIndex];
                    
                    this.addToStream({
                        source: 'Jav',
                        type: 'success',
                        content: `Switched to ${this.personalityMode} mode! ${this.getPersonalizedMessage('mode_switch', 'How does this feel?')}`,
                        actions: [
                            { id: 'perfect-personality', label: 'üëå Perfect!', type: 'primary' },
                            { id: 'try-another', label: 'üîÑ Try another', type: 'secondary' }
                        ]
                    });
                },
                
                // UI Controls
                togglePanel() {
                    if (this.panelVisible) {
                        this.panelMinimized = !this.panelMinimized;
                    } else {
                        this.panelVisible = true;
                        this.panelMinimized = false;
                    }
                },
                
                floatPanel() {
                    this.panelFloating = !this.panelFloating;
                    this.addToStream({
                        source: 'System',
                        type: 'success',
                        content: this.panelFloating ? 'üéà Panel is now floating!' : 'üìå Panel docked back!'
                    });
                },
                
                handleEnterKey(event) {
                    if (event.shiftKey) {
                        // Allow new line
                        return;
                    } else {
                        // Send message
                        this.sendMessage();
                    }
                },
                
                handleInputChange() {
                    // Auto-resize textarea
                    const textarea = event.target;
                    textarea.style.height = 'auto';
                    textarea.style.height = Math.min(textarea.scrollHeight, 120) + 'px';
                    
                    // Show typing activity to Jav
                    this.updateActivity();
                },
                
                updateActivity() {
                    this.lastActivity = Date.now();
                    this.activityStreak++;
                    this.javActive = true;
                },
                
                // Inline Hints
                showInlineHint(message, x, y, icon = 'fas fa-lightbulb') {
                    const hint = {
                        id: Date.now(),
                        message,
                        x,
                        y,
                        icon
                    };
                    
                    this.inlineHints.push(hint);
                    
                    // Auto-dismiss after 5 seconds
                    setTimeout(() => {
                        this.dismissHint(hint.id);
                    }, 5000);
                },
                
                dismissHint(hintId) {
                    this.inlineHints = this.inlineHints.filter(hint => hint.id !== hintId);
                },
                
                hideInlineHints() {
                    this.inlineHints = [];
                },
                
                handleCursorChange(event) {
                    // Occasionally show contextual hints based on cursor position
                    if (Math.random() < 0.1) { // 10% chance
                        const position = event.position;
                        const model = this.editor.getModel();
                        const line = model.getLineContent(position.lineNumber);
                        
                        if (line.includes('TODO')) {
                            this.showInlineHint('üí° Right-click for TODO actions', event.target.getBoundingClientRect().left, event.target.getBoundingClientRect().top - 50);
                        }
                    }
                },
                
                // Quick Actions
                async runQuickAction(action) {
                    this.javThinking = true;
                    this.addToStream({
                        source: 'You',
                        type: 'user-message',
                        content: `Running ${action}...`
                    });
                    
                    switch(action) {
                        case 'health':
                            try {
                                const response = await fetch('/health');
                                const data = await response.json();
                                const message = data.status === 'healthy' ? 
                                    '‚úÖ All systems healthy! We\'re good to go!' : 
                                    `‚ö†Ô∏è Health check found: ${data.status}`;
                                this.addToStream({
                                    source: 'Jav',
                                    type: data.status === 'healthy' ? 'success' : 'error',
                                    content: message
                                });
                            } catch (error) {
                                this.addToStream({
                                    source: 'Jav',
                                    type: 'error',
                                    content: '‚ùå Couldn\'t reach health endpoint, but I\'m still here!'
                                });
                            }
                            break;
                        case 'test':
                            setTimeout(() => {
                                this.addToStream({
                                    source: 'Jav',
                                    type: 'success',
                                    content: '‚úÖ Tests passed! Your code is looking solid! üéØ'
                                });
                            }, 2000);
                            break;
                    }
                    
                    setTimeout(() => {
                        this.javThinking = false;
                    }, 2000);
                },
                
                quickSave() {
                    this.addToStream({
                        source: 'Jav',
                        type: 'success',
                        content: 'üíæ Nice work! Your progress is saved. Keep the momentum going! üöÄ',
                        actions: [
                            { id: 'commit-git', label: 'üìù Commit to Git', type: 'primary' },
                            { id: 'deploy-now', label: 'üöÄ Deploy', type: 'secondary' }
                        ]
                    });
                },
                
                adaptToUserBehavior() {
                    // Simple adaptation based on activity patterns
                    const now = new Date();
                    const hour = now.getHours();
                    
                    if (hour >= 22 || hour <= 6) {
                        if (this.personalityMode !== 'Night Owl') {
                            this.personalityMode = 'Night Owl';
                            this.addToStream({
                                source: 'Jav',
                                type: 'success',
                                content: 'ü¶â Adapted to Night Owl mode for your late-night session! Need any coding fuel? ‚òï'
                            });
                        }
                    }
                },
                
                // Helper functions
                timeAgo(timestamp) {
                    const diff = Date.now() - new Date(timestamp).getTime();
                    const minutes = Math.floor(diff / 60000);
                    const seconds = Math.floor(diff / 1000);
                    
                    if (minutes > 0) return `${minutes}m ago`;
                    return `${seconds}s ago`;
                },
                
                getAvatarClass(source) {
                    const avatarClasses = {
                        'Jav': 'jav-avatar-mini',
                        'You': 'user-avatar-mini',
                        'System': 'system-avatar-mini'
                    };
                    return avatarClasses[source] || 'system-avatar-mini';
                },
                
                getAvatarIcon(source) {
                    const avatarIcons = {
                        'Jav': 'fas fa-robot',
                        'You': 'fas fa-user',
                        'System': 'fas fa-cog'
                    };
                    return avatarIcons[source] || 'fas fa-circle';
                },
                
                getBubbleClass(source) {
                    const bubbleClasses = {
                        'Jav': 'jav-bubble',
                        'You': 'user-bubble',
                        'System': 'system-bubble'
                    };
                    return bubbleClasses[source] || 'system-bubble';
                }
            }
        }
    </script>
</body>
</html>
